---
phase: 14-type-foundation
plan: 04
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - customer/app/pages/status/[id].vue
  - customer/app/composables/useWaitTimeEstimate.ts
  - customer/server/api/submit.post.ts
autonomous: true

must_haves:
  truths:
    - "Customer status page uses PickupStatus type for status display"
    - "useWaitTimeEstimate uses PICKUP_STATUS for query filters"
    - "submit.post.ts uses PICKUP_STATUS for initial status and duplicate check"
    - "No magic strings remain in customer app files"
  artifacts:
    - path: "customer/app/pages/status/[id].vue"
      provides: "Status page with typed status handling"
      contains: "from '#shared/types/pickup-request'"
    - path: "customer/server/api/submit.post.ts"
      provides: "Submission endpoint with typed status"
      contains: "PICKUP_STATUS"
  key_links:
    - from: "customer/app/pages/status/[id].vue"
      to: "#shared/types/pickup-request"
      via: "import PickupRequest"
      pattern: "import.*from '#shared/types/pickup-request'"
    - from: "customer/server/api/submit.post.ts"
      to: "#shared/types/pickup-request"
      via: "import PICKUP_STATUS"
      pattern: "PICKUP_STATUS\\.PENDING"
---

<objective>
Migrate customer app files to use centralized type definitions.

Purpose: Complete the type migration by updating customer app to use typed constants from #shared.
Output: All 3 customer app files use imports from #shared instead of inline types and strings.
</objective>

<execution_context>
@/Users/thomas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/14-type-foundation/14-01-SUMMARY.md

# Files to migrate
@customer/app/pages/status/[id].vue
@customer/app/composables/useWaitTimeEstimate.ts
@customer/server/api/submit.post.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate customer status page and composable</name>
  <files>customer/app/pages/status/[id].vue, customer/app/composables/useWaitTimeEstimate.ts</files>
  <action>
Update customer frontend files:

**status/[id].vue:**
1. Add imports:
   ```typescript
   import { PICKUP_STATUS } from '#shared/types/pickup-request'
   import type { PickupRequest, PickupStatus } from '#shared/types/pickup-request'
   ```
2. Remove any local PickupRequest interface definition
3. Replace status comparisons:
   - `status === 'pending'` -> `status === PICKUP_STATUS.PENDING`
   - `status === 'completed'` -> `status === PICKUP_STATUS.COMPLETED`
   - etc.
4. Update any template conditionals that check status strings

**useWaitTimeEstimate.ts:**
1. Add imports:
   ```typescript
   import { PICKUP_STATUS } from '#shared/types/pickup-request'
   import type { PickupStatus } from '#shared/types/pickup-request'
   ```
2. Replace status strings in query filters:
   - `status: 'pending'` -> `status: PICKUP_STATUS.PENDING`
   - `status: 'in_queue'` -> `status: PICKUP_STATUS.IN_QUEUE`
3. If the file has `status: string` type, change to `status: PickupStatus`
  </action>
  <verify>
Run `npx nuxi typecheck customer` - no type errors
Grep: `grep -E "'pending'|'approved'|'completed'" customer/app/` returns no matches
  </verify>
  <done>
Status page and composable use typed imports, no magic strings.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate customer server API</name>
  <files>customer/server/api/submit.post.ts</files>
  <action>
Update the submission API endpoint:

1. Add imports at top:
   ```typescript
   import { PICKUP_STATUS } from '#shared/types/pickup-request'
   import type { PickupRequest, PickupStatus } from '#shared/types/pickup-request'
   ```

2. Remove any local PickupRequest interface

3. Replace status strings:
   - Initial status when creating: `status: 'pending'` -> `status: PICKUP_STATUS.PENDING`
   - Duplicate check query: `status: ['pending', 'approved', ...]` -> use ACTIVE_STATUSES or explicit array with PICKUP_STATUS constants

4. If the file uses `status: string` in any type, change to PickupStatus

Note: Server code in Nuxt 4 can import from #shared just like app code.
  </action>
  <verify>
Run `npx nuxi typecheck customer` - no type errors
Grep: `grep -E "'pending'|'approved'" customer/server/` returns no matches
Test: Run `curl -X POST http://localhost:3001/api/submit` with test data (optional, verifies runtime)
  </verify>
  <done>
Submit API uses PICKUP_STATUS.PENDING for initial status, typed PickupRequest.
  </done>
</task>

</tasks>

<verification>
1. `npx nuxi typecheck customer` passes
2. `grep -rE "'pending'|'approved'|'in_queue'|'processing'|'completed'|'cancelled'" customer/app/ customer/server/` returns no matches
3. All files import from '#shared/types/pickup-request'
4. `npm run build --prefix customer` succeeds (full build verification)
</verification>

<success_criteria>
- status/[id].vue uses PICKUP_STATUS constants for status display logic
- useWaitTimeEstimate uses PICKUP_STATUS for query filters
- submit.post.ts uses PICKUP_STATUS.PENDING for initial status
- No local PickupRequest interfaces remain
- No magic status strings in any of the 3 files
- Build passes for customer app
</success_criteria>

<output>
After completion, create `.planning/phases/14-type-foundation/14-04-SUMMARY.md`
</output>
