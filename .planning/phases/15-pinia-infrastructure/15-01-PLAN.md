---
phase: 15-pinia-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - staff/nuxt.config.ts
  - staff/package.json
autonomous: true

must_haves:
  truths:
    - "Pinia is installed and configured in staff app"
    - "@pinia/nuxt module is listed in nuxt.config.ts modules array"
    - "defineStore and storeToRefs are auto-imported"
  artifacts:
    - path: "staff/nuxt.config.ts"
      provides: "Pinia module configuration"
      contains: "@pinia/nuxt"
    - path: "staff/package.json"
      provides: "Pinia dependencies"
      contains: "@pinia/nuxt"
  key_links:
    - from: "staff/nuxt.config.ts"
      to: "@pinia/nuxt"
      via: "modules array"
      pattern: "modules.*@pinia/nuxt"
---

<objective>
Install @pinia/nuxt module and configure it for the staff application.

Purpose: Establish the Pinia infrastructure required for state management stores.
Output: Pinia is installed, configured, and auto-imports are available.
</objective>

<execution_context>
@/Users/thomas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-pinia-infrastructure/15-RESEARCH.md

# Current nuxt.config.ts structure
@staff/nuxt.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @pinia/nuxt module</name>
  <files>staff/package.json, staff/pnpm-lock.yaml</files>
  <action>
Run the Nuxt CLI to add the Pinia module. This installs both `pinia` and `@pinia/nuxt`:

```bash
cd staff && npx nuxi module add pinia
```

This command:
1. Installs `@pinia/nuxt` and `pinia` packages
2. Automatically adds `@pinia/nuxt` to the modules array in nuxt.config.ts

If the CLI doesn't auto-update nuxt.config.ts, manually add `'@pinia/nuxt'` to the modules array.
  </action>
  <verify>
Run `cat staff/package.json | grep -A5 '"dependencies"'` to verify @pinia/nuxt is listed.
Run `cat staff/nuxt.config.ts` to verify @pinia/nuxt is in modules array.
  </verify>
  <done>@pinia/nuxt appears in package.json dependencies and nuxt.config.ts modules array.</done>
</task>

<task type="auto">
  <name>Task 2: Verify auto-imports work</name>
  <files>staff/.nuxt/types/imports.d.ts</files>
  <action>
Regenerate Nuxt types and verify Pinia exports are auto-imported:

```bash
cd staff && npx nuxi prepare
```

Check that the generated types include:
- `defineStore` from pinia
- `storeToRefs` from pinia

You can verify by checking `.nuxt/types/imports.d.ts` contains these exports.

Additionally, run the dev server briefly to ensure no errors:

```bash
cd staff && npm run dev &
sleep 5
kill %1
```

The dev server should start without Pinia-related errors.
  </action>
  <verify>
Run `grep -E "(defineStore|storeToRefs)" staff/.nuxt/types/imports.d.ts` to verify auto-imports.
  </verify>
  <done>defineStore and storeToRefs are auto-imported and available in the staff app.</done>
</task>

</tasks>

<verification>
1. `@pinia/nuxt` appears in staff/package.json dependencies
2. `@pinia/nuxt` appears in staff/nuxt.config.ts modules array
3. `defineStore` and `storeToRefs` are listed in .nuxt/types/imports.d.ts
4. Dev server starts without errors
</verification>

<success_criteria>
- Pinia module is installed and configured
- Auto-imports are working (defineStore, storeToRefs available)
- No TypeScript or runtime errors related to Pinia
</success_criteria>

<output>
After completion, create `.planning/phases/15-pinia-infrastructure/15-01-SUMMARY.md`
</output>
