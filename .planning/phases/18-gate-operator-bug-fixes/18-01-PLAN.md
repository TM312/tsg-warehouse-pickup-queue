---
phase: 18-gate-operator-bug-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - staff/app/composables/useGateNavigation.ts
  - staff/app/components/gate/GateNavButtons.vue
autonomous: true

must_haves:
  truths:
    - "Navigation composable provides prev/next gate computed refs"
    - "Navigation composable handles keyboard shortcuts (left/right arrows)"
    - "Keyboard navigation only triggers when not in input field"
    - "Navigation wraps around (first->last, last->first)"
  artifacts:
    - path: "staff/app/composables/useGateNavigation.ts"
      provides: "Gate navigation logic with keyboard support"
      exports: ["useGateNavigation"]
    - path: "staff/app/components/gate/GateNavButtons.vue"
      provides: "Prev/Next navigation button UI"
  key_links:
    - from: "staff/app/composables/useGateNavigation.ts"
      to: "useGatesStore"
      via: "sortedActiveGates getter"
      pattern: "gatesStore\\.sortedActiveGates"
    - from: "staff/app/composables/useGateNavigation.ts"
      to: "useMagicKeys"
      via: "VueUse keyboard composable"
      pattern: "useMagicKeys"
---

<objective>
Create gate navigation infrastructure: a composable for prev/next gate logic with keyboard support, and a reusable button component.

Purpose: Enable gate operators to navigate between gates efficiently using buttons or keyboard shortcuts
Output: Composable (useGateNavigation.ts) and UI component (GateNavButtons.vue) ready for integration
</objective>

<execution_context>
@/Users/thomas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/18-gate-operator-bug-fixes/18-RESEARCH.md

# Existing patterns to follow
@staff/app/stores/gates.ts
@staff/app/composables/useQueueActions.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useGateNavigation composable</name>
  <files>staff/app/composables/useGateNavigation.ts</files>
  <action>
Create a composable that accepts `currentGateId: Ref<string>` and provides:

1. `prevGate` / `nextGate` - computed refs returning GateWithCount or null
2. `goToPrev()` / `goToNext()` - navigation functions using router.push
3. Keyboard shortcuts using useMagicKeys from @vueuse/core

Implementation details:
- Use `useGatesStore().sortedActiveGates` for alphabetically ordered gates
- Wrap-around: when at first gate, prev goes to last; when at last, next goes to first
- Guard keyboard navigation: check `document.activeElement?.tagName` to skip if INPUT/TEXTAREA focused
- Use VueUse `whenever` for cleaner reactive keyboard handling
- Import useRouter from vue-router (Nuxt auto-import)

Pattern from research:
```typescript
const { ArrowLeft, ArrowRight } = useMagicKeys()

function isInputActive() {
  const el = document.activeElement
  return el?.tagName === 'INPUT' || el?.tagName === 'TEXTAREA'
}

whenever(ArrowLeft, () => {
  if (!isInputActive()) goToPrev()
})
```
  </action>
  <verify>
TypeScript compiles without errors: `cd staff && npx nuxi typecheck 2>&1 | head -30`
  </verify>
  <done>
Composable exports useGateNavigation function with prevGate, nextGate, goToPrev, goToNext
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GateNavButtons component</name>
  <files>staff/app/components/gate/GateNavButtons.vue</files>
  <action>
Create a Vue component that renders prev/next navigation buttons around the current gate name.

Props:
- `currentGate: { id: string; gate_number: number }` - current gate info

Implementation:
1. Call `useGateNavigation(computed(() => props.currentGate.id))` to get navigation state
2. Render structure:
   - Button (ghost, sm) with ChevronLeft icon + prev gate number (hidden on mobile)
   - Current gate name in center (bold, text-lg)
   - Button (ghost, sm) with next gate number (hidden on mobile) + ChevronRight icon
3. Buttons disabled when prevGate/nextGate is null (though with wrap-around, only null when single gate)
4. Use Tailwind `hidden sm:inline` for responsive gate numbers on buttons

Use existing Button component from @/components/ui/button.
Import ChevronLeft, ChevronRight from lucide-vue-next.
  </action>
  <verify>
TypeScript compiles without errors: `cd staff && npx nuxi typecheck 2>&1 | head -30`
  </verify>
  <done>
GateNavButtons component renders navigation UI and connects to useGateNavigation
  </done>
</task>

</tasks>

<verification>
- [ ] `staff/app/composables/useGateNavigation.ts` exists and exports useGateNavigation
- [ ] `staff/app/components/gate/GateNavButtons.vue` exists
- [ ] TypeScript compilation passes
- [ ] Navigation uses sortedActiveGates for consistent ordering
</verification>

<success_criteria>
Gate navigation infrastructure complete and ready for integration into gate page
</success_criteria>

<output>
After completion, create `.planning/phases/18-gate-operator-bug-fixes/18-01-SUMMARY.md`
</output>
