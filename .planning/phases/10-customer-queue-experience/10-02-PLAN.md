---
phase: 10-customer-queue-experience
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - customer/app/pages/status/[id].vue
autonomous: true

must_haves:
  truths:
    - "Loading state shows skeleton instead of 'Loading...' text"
    - "Live indicator badge appears when connected"
    - "Completed status shows receipt-like confirmation with checkmark"
    - "Cancelled status shows message with link to submit new request"
    - "Error state shows 'Not Found' with link to submit new request"
  artifacts:
    - path: "customer/app/pages/status/[id].vue"
      provides: "Enhanced status page with all states"
      contains: "StatusSkeleton"
      min_lines: 250
  key_links:
    - from: "customer/app/pages/status/[id].vue"
      to: "customer/app/components/StatusSkeleton.vue"
      via: "component import/usage"
      pattern: "StatusSkeleton"
    - from: "customer/app/pages/status/[id].vue"
      to: "customer/app/components/LiveIndicator.vue"
      via: "component import/usage"
      pattern: "LiveIndicator"
    - from: "customer/app/pages/status/[id].vue"
      to: "customer/app/components/CompletedStatus.vue"
      via: "component import/usage"
      pattern: "CompletedStatus"
---

<objective>
Integrate Phase 10 components into the customer status page and enhance all status displays.

Purpose: Complete the customer queue experience by replacing loading text with skeleton, adding live indicator, improving completion confirmation, and enhancing error/cancelled states with navigation links.

Output: Enhanced status page fulfilling CUST-04 and CUST-05 requirements.
</objective>

<execution_context>
@/Users/thomas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-customer-queue-experience/10-CONTEXT.md
@.planning/phases/10-customer-queue-experience/10-RESEARCH.md
@.planning/phases/10-customer-queue-experience/10-01-SUMMARY.md
@customer/app/pages/status/[id].vue
@customer/app/components/StatusSkeleton.vue
@customer/app/components/LiveIndicator.vue
@customer/app/components/CompletedStatus.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace loading state with skeleton and add live indicator</name>
  <files>customer/app/pages/status/[id].vue</files>
  <action>
Update the loading state and add live indicator:

1. **Replace loading Card with StatusSkeleton:**
- Change `<Card v-if="pending">` block to just `<StatusSkeleton v-if="pending" />`
- Remove the old CardHeader/CardContent with "Loading..." text

2. **Add LiveIndicator to connected state:**
- In the status display Card header, add LiveIndicator next to the title
- Position it after CardTitle with a flex wrapper
- Pass `:show="realtimeStatus === 'connected'"` prop
- Layout: wrap CardTitle in a flex container with items-center justify-center gap-2
- Example structure:
```vue
<CardHeader class="text-center space-y-2">
  <div class="flex items-center justify-center gap-2">
    <CardTitle class="text-xl md:text-2xl">{{ statusDisplay?.title }}</CardTitle>
    <LiveIndicator :show="realtimeStatus === 'connected'" />
  </div>
  <p class="text-sm text-muted-foreground">
    Order: {{ request.sales_order_number }}
  </p>
</CardHeader>
```

3. **Import components at top of script:**
- Add import for StatusSkeleton (auto-imported by Nuxt but explicit is clearer)
- Add import for LiveIndicator
  </action>
  <verify>
```bash
grep -q "StatusSkeleton" customer/app/pages/status/\\[id\\].vue && echo "Uses StatusSkeleton"
grep -q "LiveIndicator" customer/app/pages/status/\\[id\\].vue && echo "Uses LiveIndicator"
grep -q "Loading..." customer/app/pages/status/\\[id\\].vue || echo "No more Loading... text"
```
  </verify>
  <done>Loading state shows skeleton; Live indicator badge appears when connected to realtime</done>
</task>

<task type="auto">
  <name>Task 2: Enhance completed and cancelled status displays</name>
  <files>customer/app/pages/status/[id].vue</files>
  <action>
Update status-specific displays per CONTEXT.md decisions:

1. **Completed status - use CompletedStatus component:**
- Replace the current completed message with CompletedStatus component
- In CardContent, add conditional: `v-if="request.status === 'completed'"`
- Pass props: `:order-number="request.sales_order_number"` and `:gate-number="gateNumber"`
- Note: gateNumber computed property already exists
- This replaces the generic statusDisplay.message for completed

2. **Cancelled status - add link to submit new request:**
- Add a dedicated section for cancelled status in CardContent
- Use `v-else-if="request.status === 'cancelled'"` after completed
- Layout: centered div with space-y-4 py-4
- Icon: XCircle from lucide-vue-next, w-12 h-12 mx-auto text-muted-foreground
- Title: "Request Cancelled" in text-lg font-medium
- Message: "This pickup request has been cancelled." in text-muted-foreground text-sm
- Link: `<NuxtLink to="/" class="text-primary hover:underline text-sm">Submit a new request</NuxtLink>`
- Styling: muted/neutral colors (NOT red/warning per CONTEXT.md)

3. **Update conditional flow in template:**
- Order: completed -> cancelled -> in_queue (showPosition) -> other statuses
- The existing `v-if="statusDisplay?.message"` should only catch pending/approved/unknown

4. **Import XCircle icon:**
- Add to lucide-vue-next imports
  </action>
  <verify>
```bash
grep -q "CompletedStatus" customer/app/pages/status/\\[id\\].vue && echo "Uses CompletedStatus"
grep -q "XCircle" customer/app/pages/status/\\[id\\].vue && echo "Uses XCircle"
grep -q "Submit a new request" customer/app/pages/status/\\[id\\].vue && echo "Has submit link"
```
  </verify>
  <done>Completed status shows receipt-like CompletedStatus; Cancelled status shows message with link to submit new request</done>
</task>

<task type="auto">
  <name>Task 3: Enhance error state with navigation link</name>
  <files>customer/app/pages/status/[id].vue</files>
  <action>
Improve the "Request Not Found" error state:

1. **Update the error Card (fetchError || !request condition):**
- Keep CardHeader with "Request Not Found" title
- Change CardTitle styling: remove text-destructive (per CONTEXT.md - neutral, not warning)
- Keep CardContent centered

2. **Add helpful message and link:**
- Message: "We couldn't find a pickup request with this ID."
- Add a Button wrapped in NuxtLink: `<NuxtLink to="/"><Button variant="outline">Submit a New Request</Button></NuxtLink>`
- Layout: space-y-4 between message and button

3. **Import Button component:**
- Add: `import { Button } from '@/components/ui/button'`

4. **Structure:**
```vue
<Card v-else-if="fetchError || !request">
  <CardHeader class="text-center">
    <CardTitle class="text-xl md:text-2xl">Request Not Found</CardTitle>
  </CardHeader>
  <CardContent class="text-center space-y-4">
    <p class="text-muted-foreground">
      We couldn't find a pickup request with this ID.
    </p>
    <NuxtLink to="/">
      <Button variant="outline">Submit a New Request</Button>
    </NuxtLink>
  </CardContent>
</Card>
```
  </action>
  <verify>
```bash
grep -q 'Button.*variant="outline"' customer/app/pages/status/\\[id\\].vue && echo "Has outline button"
grep -q "Submit a New Request" customer/app/pages/status/\\[id\\].vue && echo "Has submit button text"
grep -q "text-destructive" customer/app/pages/status/\\[id\\].vue || echo "No destructive styling"
```
  </verify>
  <done>Error state shows neutral styling with clear message and button to submit new request</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. TypeScript compilation passes:
```bash
cd customer && pnpm vue-tsc --noEmit 2>&1 | head -20
```

2. Dev server starts without errors:
```bash
cd customer && timeout 15 pnpm dev 2>&1 | grep -E "(ready|error|Error)" | head -5
```

3. All components are used in status page:
```bash
grep -E "(StatusSkeleton|LiveIndicator|CompletedStatus|XCircle)" customer/app/pages/status/\\[id\\].vue | wc -l
# Should be >= 4 (one for each component)
```

4. Status page covers all states:
- pending: shows message
- approved: shows message
- in_queue: shows PositionDisplay + WaitTimeEstimate + gate
- completed: shows CompletedStatus
- cancelled: shows message + link
- error: shows message + button
</verification>

<success_criteria>
- Loading state shows StatusSkeleton with card-shaped placeholders
- LiveIndicator badge appears next to title when realtimeStatus is 'connected'
- Completed status shows CompletedStatus with checkmark, order number, and gate
- Cancelled status shows neutral message with "Submit a new request" link
- Error state shows "Request Not Found" with outline button to submit new request
- All imports and components compile without TypeScript errors
- CUST-04 (real-time queue status display) fully satisfied
- CUST-05 (visual confirmation when pickup complete) fully satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/10-customer-queue-experience/10-02-SUMMARY.md`
</output>
