---
phase: 09-realtime-queue-updates
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - customer/app/pages/status/[id].vue
  - customer/app/components/PositionDisplay.vue
  - customer/app/components/PickupRequestForm.vue
autonomous: true

must_haves:
  truths:
    - "Customer sees their queue position after submission"
    - "Position number animates smoothly when it changes"
    - "Position #1 shows 'Your turn any moment' text"
    - "Form submission navigates to status page"
  artifacts:
    - path: "customer/app/pages/status/[id].vue"
      provides: "Status page for viewing queue position"
      contains: "useRealtimeStatus"
    - path: "customer/app/components/PositionDisplay.vue"
      provides: "Animated position display component"
      contains: "useTransition"
  key_links:
    - from: "customer/app/components/PickupRequestForm.vue"
      to: "/status/[id]"
      via: "navigateTo after successful submission"
      pattern: "navigateTo.*status"
    - from: "customer/app/pages/status/[id].vue"
      to: "useRealtimeStatus"
      via: "composable import and subscription"
      pattern: "useRealtimeStatus.*subscribe"
---

<objective>
Create the customer status page and position display with animated transitions.

Purpose: Customers need to see their queue position after submitting a pickup request. The position should animate smoothly when it changes, providing visual feedback that the queue is live.

Output: Status page at `/status/[id]` that displays queue position with animated number transitions, and updates the form to navigate there after submission.
</objective>

<execution_context>
@/Users/thomas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-realtime-queue-updates/09-CONTEXT.md
@.planning/phases/09-realtime-queue-updates/09-RESEARCH.md
@customer/app/composables/useRealtimeStatus.ts
@customer/app/components/PickupRequestForm.vue
@customer/app/components/ConnectionStatus.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PositionDisplay component with animated transitions</name>
  <files>customer/app/components/PositionDisplay.vue</files>
  <action>
Create a Vue component that displays the customer's queue position with smooth number animation.

Implementation:
1. Accept `position` prop (number) and `showTurnMessage` prop (boolean, optional)
2. Use `useTransition` from @vueuse/core to animate the position number
   - Duration: 400ms
   - Easing: TransitionPresets.easeOutCubic
3. Display format: "You are #X in queue" (centered, large number)
4. When position === 1, show "Your turn any moment" text below
5. Use Vue's `<Transition>` with mode="out-in" to handle position changes
6. Style with Tailwind: large text-6xl for number, text-primary color, muted-foreground for labels

Reference research code example for PositionDisplay.vue in 09-RESEARCH.md.
  </action>
  <verify>Component file exists at customer/app/components/PositionDisplay.vue with useTransition import</verify>
  <done>PositionDisplay component renders position with smooth animation, shows special message at position 1</done>
</task>

<task type="auto">
  <name>Task 2: Create status page with realtime subscription</name>
  <files>customer/app/pages/status/[id].vue</files>
  <action>
Create the status page that displays queue information and subscribes to realtime updates.

Implementation:
1. Create pages/status/[id].vue with dynamic route parameter
2. Use `useRoute()` to get the request ID from params
3. Fetch initial request data from Supabase:
   - Query pickup_requests by id
   - Include: status, queue_position, assigned_gate_id
   - Join gates table to get gate_number
4. Use `useRealtimeStatus(requestId)` composable to subscribe to updates
5. In the subscribe callback, update local request state from payload
6. Display states:
   - pending: "Your request is being reviewed"
   - approved: "Your request has been approved"
   - in_queue: Show PositionDisplay with queue_position
   - completed: "Pickup complete - thank you!"
   - cancelled: "Request cancelled"
7. Show gate assignment when assigned: "Gate X"
8. Include ConnectionStatus component for connection feedback
9. Handle not found (404) if request doesn't exist

Layout:
- Card component wrapping content
- Centered, mobile-friendly layout matching existing customer app style
- ConnectionStatus at bottom of screen
  </action>
  <verify>cd customer && pnpm nuxt prepare && pnpm build (no TypeScript errors)</verify>
  <done>Status page at /status/[id] shows queue position, subscribes to realtime updates, displays gate when assigned</done>
</task>

<task type="auto">
  <name>Task 3: Update form to navigate to status page after submission</name>
  <files>customer/app/components/PickupRequestForm.vue</files>
  <action>
Modify the PickupRequestForm to navigate to the status page after successful submission instead of showing inline success message.

Changes:
1. Remove successData ref and success state template section
2. After successful submission (data.value?.success), call:
   `await navigateTo(`/status/${data.value.requestId}`)`
3. Remove the "Submit Another Request" button and related resetForm logic
4. Keep error handling as-is (inline error display)

The form will now be a one-way flow: submit -> navigate to status page.
  </action>
  <verify>cd customer && pnpm build (no errors)</verify>
  <done>Form submission navigates to /status/[id] page, no longer shows inline success</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. Start local Supabase: `supabase start`
2. Start customer app: `cd customer && pnpm dev`
3. Submit a pickup request with the form
4. Verify navigation to /status/[id] page
5. Verify position displays correctly
6. Change queue_position in Supabase (or have staff app change it) and verify realtime update
7. Verify position #1 shows "Your turn any moment" message
</verification>

<success_criteria>
1. Status page exists at /status/[id] and loads request data
2. PositionDisplay shows animated position number
3. Position #1 displays special "any moment" message
4. Realtime subscription updates position when it changes
5. Gate assignment displays when staff assigns a gate
6. Form navigates to status page after successful submission
</success_criteria>

<output>
After completion, create `.planning/phases/09-realtime-queue-updates/09-01-SUMMARY.md`
</output>
