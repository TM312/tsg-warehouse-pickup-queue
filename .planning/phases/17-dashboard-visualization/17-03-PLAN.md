---
phase: 17-dashboard-visualization
plan: 03
type: execute
wave: 2
depends_on: ["17-01"]
files_modified:
  - staff/app/components/dashboard/KpiCard.vue
  - staff/app/components/dashboard/QueueBarChart.vue
autonomous: true

must_haves:
  truths:
    - "KPI cards display value and label with loading skeleton"
    - "Bar chart visualizes queue counts per gate"
    - "Components handle empty data gracefully"
  artifacts:
    - path: "staff/app/components/dashboard/KpiCard.vue"
      provides: "Reusable KPI display card"
      min_lines: 20
    - path: "staff/app/components/dashboard/QueueBarChart.vue"
      provides: "Bar chart with Unovis"
      min_lines: 40
  key_links:
    - from: "staff/app/components/dashboard/QueueBarChart.vue"
      to: "@unovis/vue"
      via: "VisXYContainer, VisGroupedBar imports"
      pattern: "VisXYContainer|VisGroupedBar"
    - from: "staff/app/components/dashboard/KpiCard.vue"
      to: "components/ui/card"
      via: "Card component import"
      pattern: "@/components/ui/card"
---

<objective>
Create dashboard UI components: KpiCard for metrics display and QueueBarChart for gate queue visualization.

Purpose: Reusable components for dashboard that follow shadcn-vue patterns and integrate with Unovis charts.
Output: KpiCard.vue and QueueBarChart.vue components ready for use.
</objective>

<execution_context>
@/Users/thomas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/17-dashboard-visualization/17-RESEARCH.md
@.planning/phases/17-dashboard-visualization/17-CONTEXT.md
@staff/app/components/ui/card/index.ts
@staff/app/components/ui/skeleton/Skeleton.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create KpiCard component</name>
  <files>staff/app/components/dashboard/KpiCard.vue</files>
  <action>
    Create a simple KPI card component that displays a value and label:

    ```vue
    <!-- staff/app/components/dashboard/KpiCard.vue -->
    <script setup lang="ts">
    import { Card, CardContent } from '@/components/ui/card'
    import { Skeleton } from '@/components/ui/skeleton'

    defineProps<{
      label: string
      value: string | number | null
      loading?: boolean
    }>()
    </script>

    <template>
      <Card>
        <CardContent class="p-6">
          <div v-if="loading" class="space-y-2">
            <Skeleton class="h-8 w-20" />
            <Skeleton class="h-4 w-24" />
          </div>
          <template v-else>
            <div class="text-2xl font-bold">
              {{ value ?? '--' }}
            </div>
            <p class="text-sm text-muted-foreground">
              {{ label }}
            </p>
          </template>
        </CardContent>
      </Card>
    </template>
    ```

    Key design decisions per CONTEXT.md:
    - Display value + label only (no trends, no icons)
    - Show "--" when value is null
    - Skeleton placeholders during loading
    - Cards are not clickable (display only)
  </action>
  <verify>
    - `cat staff/app/components/dashboard/KpiCard.vue | grep "text-2xl font-bold"` shows value styling
    - `cat staff/app/components/dashboard/KpiCard.vue | grep "Skeleton"` shows loading state
  </verify>
  <done>
    KpiCard component displays value/label with loading skeleton
  </done>
</task>

<task type="auto">
  <name>Task 2: Create QueueBarChart component</name>
  <files>staff/app/components/dashboard/QueueBarChart.vue</files>
  <action>
    Create bar chart component using Unovis for gate queue visualization:

    ```vue
    <!-- staff/app/components/dashboard/QueueBarChart.vue -->
    <script setup lang="ts">
    import { computed } from 'vue'
    import { VisXYContainer, VisGroupedBar, VisAxis, VisTooltip } from '@unovis/vue'
    import { GroupedBar } from '@unovis/ts'
    import { Skeleton } from '@/components/ui/skeleton'

    interface GateQueueData {
      gate: string
      count: number
      gateId: string
    }

    const props = defineProps<{
      data: GateQueueData[]
      loading?: boolean
    }>()

    // Accessor functions for Unovis
    const x = (d: GateQueueData) => d.gate
    const y = (d: GateQueueData) => d.count

    // Tooltip template
    const tooltipTemplate = (d: GateQueueData) => {
      return `<div class="bg-popover text-popover-foreground rounded-md border px-3 py-1.5 text-sm shadow-md">
        <div class="font-medium">${d.gate}</div>
        <div class="text-muted-foreground">${d.count} waiting</div>
      </div>`
    }

    // Chart color using CSS variable
    const barColor = 'hsl(var(--chart-1))'

    // Check if there's any data
    const hasData = computed(() => props.data.length > 0)
    </script>

    <template>
      <div class="w-full h-[300px]">
        <!-- Loading state -->
        <div v-if="loading" class="flex items-end justify-around h-full p-4 gap-4">
          <Skeleton v-for="i in 4" :key="i" class="flex-1" :style="{ height: `${30 + Math.random() * 50}%` }" />
        </div>

        <!-- Empty state -->
        <div v-else-if="!hasData" class="flex items-center justify-center h-full text-muted-foreground">
          No gates configured
        </div>

        <!-- Chart -->
        <VisXYContainer v-else :data="data" class="h-full">
          <VisGroupedBar
            :x="x"
            :y="y"
            :color="barColor"
            :rounded-corners="4"
            :bar-padding="0.2"
          />
          <VisAxis
            type="x"
            :grid-line="false"
            :domain-line="false"
            :tick-line="false"
          />
          <VisAxis
            type="y"
            :grid-line="true"
            :domain-line="false"
            :tick-line="false"
            :tick-format="(v: number) => String(Math.round(v))"
          />
          <VisTooltip :triggers="{ [GroupedBar.selectors.bar]: tooltipTemplate }" />
        </VisXYContainer>
      </div>
    </template>

    <style scoped>
    /* Ensure Unovis container takes full height */
    :deep(.unovis-xy-container) {
      height: 100%;
    }
    </style>
    ```

    Key design decisions per CONTEXT.md:
    - Vertical bar chart (gates on x-axis, queue count on y-axis)
    - Shows current queue length per gate
    - Tooltip on hover shows details
    - Chart is visualization only (no click navigation)
    - Uses --chart-1 CSS variable for theming
  </action>
  <verify>
    - `cat staff/app/components/dashboard/QueueBarChart.vue | grep "VisXYContainer"` shows Unovis container
    - `cat staff/app/components/dashboard/QueueBarChart.vue | grep "VisGroupedBar"` shows bar chart
    - `cat staff/app/components/dashboard/QueueBarChart.vue | grep "VisTooltip"` shows tooltip
    - `cd staff && pnpm nuxi typecheck 2>&1 | grep -v "native-select" | grep -i error | wc -l` returns 0
  </verify>
  <done>
    QueueBarChart component renders bar chart with Unovis, handles empty/loading states
  </done>
</task>

</tasks>

<verification>
Run these checks after all tasks:
1. `ls staff/app/components/dashboard/KpiCard.vue staff/app/components/dashboard/QueueBarChart.vue` - Both files exist
2. `grep "VisXYContainer" staff/app/components/dashboard/QueueBarChart.vue` - Uses Unovis
3. `grep "Skeleton" staff/app/components/dashboard/KpiCard.vue` - Has loading state
4. `cd staff && pnpm nuxi typecheck 2>&1 | grep -v "native-select" | grep -i error` - No new type errors
</verification>

<success_criteria>
- KpiCard.vue displays value + label with skeleton loading state
- QueueBarChart.vue renders bar chart using Unovis components
- Both components handle empty/null data gracefully
- Tooltip shows gate name and waiting count
- Type check passes
</success_criteria>

<output>
After completion, create `.planning/phases/17-dashboard-visualization/17-03-SUMMARY.md`
</output>
