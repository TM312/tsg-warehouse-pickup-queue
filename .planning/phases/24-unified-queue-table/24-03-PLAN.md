---
phase: 24-unified-queue-table
plan: 03
type: execute
wave: 3
depends_on: ["24-02"]
files_modified:
  - staff/app/pages/index.vue
  - staff/app/components/dashboard/GateQueueList.vue
  - staff/app/components/dashboard/RequestsTable.vue
autonomous: false

must_haves:
  truths:
    - "All Requests tab uses QueueTable in sort mode"
    - "Gate tabs use QueueTable in drag mode"
    - "GateQueueList component is deleted from codebase"
    - "RequestsTable component is deleted from codebase"
  artifacts:
    - path: "staff/app/pages/index.vue"
      provides: "Dashboard using unified QueueTable"
      contains: "QueueTable"
  key_links:
    - from: "staff/app/pages/index.vue"
      to: "staff/app/components/dashboard/QueueTable.vue"
      via: "component import"
      pattern: "import QueueTable"
---

<objective>
Wire up the new QueueTable component in the dashboard and remove deprecated components.

Purpose: Complete the migration by replacing RequestsTable and GateQueueList usages with QueueTable, then delete the old components.

Output: Dashboard using unified QueueTable, deprecated components removed.
</objective>

<execution_context>
@/Users/thomas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/24-unified-queue-table/24-CONTEXT.md
@.planning/phases/24-unified-queue-table/24-01-SUMMARY.md
@.planning/phases/24-unified-queue-table/24-02-SUMMARY.md

@staff/app/pages/index.vue
@staff/app/components/dashboard/QueueTable.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace RequestsTable and GateQueueList with QueueTable in dashboard</name>
  <files>staff/app/pages/index.vue</files>
  <action>
Update index.vue to use QueueTable for both tabs:

1. Update imports:
```typescript
// Remove these:
// import RequestsTable from '@/components/dashboard/RequestsTable.vue'
// import GateQueueList from '@/components/dashboard/GateQueueList.vue'

// Add:
import QueueTable from '@/components/dashboard/QueueTable.vue'
import { createColumns, createDragModeColumns } from '@/components/dashboard/queueTableColumns'
```

2. Add drag mode columns (computed to include action callbacks):
```typescript
const dragModeColumns = computed(() => createDragModeColumns({
  pendingIds: pending.value,
  onComplete: handleComplete,
  onSetPriority: handleSetPriority,
  onClearPriority: handleClearPriority,
}))
```

Wait - looking at existing GateQueueList, it has inline action buttons (Complete, Priority). We need to handle this in QueueTable drag mode.

**Revised approach for drag mode actions:**

The drag mode should emit actions rather than rendering buttons inline. Update QueueTable to support action slots or pass action handlers. Actually, looking at GateQueueList more closely:

It emits: reorder, set-priority, clear-priority, complete, row-click

QueueTable in drag mode should emit the same. The template in drag mode should include the action buttons like GateQueueList does.

Update index.vue template:

```vue
<!-- All Requests tab -->
<TabsContent value="all" class="mt-4">
  <div class="flex justify-end gap-4 mb-4">
    <ShowUnassignedToggle v-model:showOnlyUnassigned="showOnlyUnassigned" />
    <ShowCompletedToggle v-model:showCompleted="showCompleted" />
  </div>
  <QueueTable
    mode="sort"
    :columns="columns"
    :data="filteredRequests"
    @row-click="handleRowClick"
  />
</TabsContent>

<!-- Gate tabs -->
<TabsContent v-for="gate in gatesWithQueues" :key="gate.id" :value="`gate-${gate.id}`" class="mt-4">
  <QueueTable
    mode="drag"
    :gate-id="gate.id"
    :data="gate.queue"
    @reorder="(ids) => handleReorder(gate.id, ids)"
    @set-priority="handleSetPriority"
    @clear-priority="handleClearPriority"
    @complete="handleComplete"
    @row-click="handleQueueRowClick"
  />
</TabsContent>
```

Note: QueueTable in drag mode needs to emit set-priority, clear-priority, complete events. Ensure QueueTable.vue has these emits defined and triggers them from the inline action buttons.

If QueueTable doesn't have these emits yet, add them:
- `set-priority: [requestId: string]`
- `clear-priority: [requestId: string]`
- `complete: [requestId: string]`

And render PriorityButton and Complete button in drag mode template (copy from GateQueueList).
  </action>
  <verify>
```bash
cd /Users/thomas/Projects/tsg/warehouse-pickup-queue/staff && npm run typecheck && npm run dev
```
Test:
1. All Requests tab shows sortable table (click headers to sort)
2. Gate tabs show draggable rows with handles
3. Priority and Complete buttons work in gate tabs
4. Row click opens detail sheet in both modes
  </verify>
  <done>
index.vue uses QueueTable for both All Requests (sort mode) and Gate tabs (drag mode). All actions work correctly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Delete deprecated components</name>
  <files>
    staff/app/components/dashboard/GateQueueList.vue
    staff/app/components/dashboard/RequestsTable.vue
  </files>
  <action>
Remove the deprecated components now that QueueTable replaces them:

```bash
rm staff/app/components/dashboard/GateQueueList.vue
rm staff/app/components/dashboard/RequestsTable.vue
```

Verify no other files import these:
```bash
grep -r "GateQueueList" staff/app/
grep -r "RequestsTable" staff/app/
```

If any other files still import them, update those imports to use QueueTable.

After deletion, verify build still works:
```bash
cd /Users/thomas/Projects/tsg/warehouse-pickup-queue/staff && npm run build
```
  </action>
  <verify>
```bash
cd /Users/thomas/Projects/tsg/warehouse-pickup-queue/staff
ls app/components/dashboard/GateQueueList.vue 2>/dev/null && echo "ERROR: File still exists" || echo "GateQueueList deleted"
ls app/components/dashboard/RequestsTable.vue 2>/dev/null && echo "ERROR: File still exists" || echo "RequestsTable deleted"
npm run build
```
  </verify>
  <done>
GateQueueList.vue and RequestsTable.vue are deleted. No remaining imports. Build succeeds.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Unified QueueTable component replacing RequestsTable and GateQueueList:
- All Requests tab: sortable columns, click headers to sort
- Gate tabs: drag handles for reordering, keyboard accessibility
- Deprecated components removed
  </what-built>
  <how-to-verify>
1. Run `cd staff && npm run dev`
2. Navigate to http://localhost:3000
3. **All Requests tab:**
   - Click "Order #" header - should sort ascending/descending
   - Click "Created" header - should sort by date
   - Click a row - should open detail sheet
4. **Gate tab (e.g., Gate 1):**
   - Verify drag handles visible on left of each row
   - Drag a row using the handle - should reorder smoothly
   - Tab to a row, press Space, use arrows to move, press Space to drop
   - Press Cmd+Up (Mac) or Ctrl+Up to jump to top
   - Press Escape while grabbed to cancel
   - Verify Priority and Complete buttons still work
5. **Screen reader test (optional):**
   - Enable VoiceOver/NVDA
   - Focus a row, press Space
   - Confirm announcement reads position and instructions
  </how-to-verify>
  <resume-signal>Type "approved" if all functionality works, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
After all tasks:
1. `npm run build` succeeds
2. No TypeScript errors
3. GateQueueList.vue and RequestsTable.vue no longer exist
4. Dashboard functionality preserved:
   - Sort mode in All Requests
   - Drag mode in Gate tabs
   - Keyboard accessibility in drag mode
   - All action buttons work
</verification>

<success_criteria>
- index.vue imports QueueTable instead of RequestsTable/GateQueueList
- All Requests tab uses QueueTable mode="sort"
- Gate tabs use QueueTable mode="drag"
- GateQueueList.vue is deleted
- RequestsTable.vue is deleted
- Build passes with no errors
- User verifies functionality in browser
</success_criteria>

<output>
After completion, create `.planning/phases/24-unified-queue-table/24-03-SUMMARY.md`
</output>
