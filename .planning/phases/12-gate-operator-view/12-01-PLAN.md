---
phase: 12-gate-operator-view
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - staff/app/pages/gate/[id].vue
  - staff/app/components/gate/CurrentPickup.vue
  - staff/app/components/gate/EmptyGateState.vue
autonomous: true

must_haves:
  truths:
    - "Gate operator can navigate to /gate/{uuid} and see gate header with gate number"
    - "Gate operator sees current pickup (position 1 or processing) with large sales order number"
    - "Gate operator sees company name and order details (item count, PO#) for current pickup"
    - "Gate operator sees friendly empty state when no pickups assigned to gate"
    - "Gate operator sees error state when gate ID is invalid or gate is disabled"
  artifacts:
    - path: "staff/app/pages/gate/[id].vue"
      provides: "Gate operator page with dynamic routing"
      min_lines: 80
    - path: "staff/app/components/gate/CurrentPickup.vue"
      provides: "Current pickup display component"
      min_lines: 40
    - path: "staff/app/components/gate/EmptyGateState.vue"
      provides: "Empty state component for idle gate"
      min_lines: 15
  key_links:
    - from: "staff/app/pages/gate/[id].vue"
      to: "gates table"
      via: "useAsyncData with Supabase query"
      pattern: "from\\('gates'\\)"
    - from: "staff/app/pages/gate/[id].vue"
      to: "pickup_requests table"
      via: "useAsyncData with Supabase query filtered by gate"
      pattern: "from\\('pickup_requests'\\)"
    - from: "staff/app/pages/gate/[id].vue"
      to: "CurrentPickup.vue"
      via: "component import and props"
      pattern: "CurrentPickup"
---

<objective>
Create the gate operator page foundation at /gate/[id] with current pickup display.

Purpose: Gate operators need a dedicated mobile-first view to see the current pickup at their gate with prominent sales order display for verification.

Output: Working /gate/[id] route showing gate header, current pickup with large sales order number, company name, order details, and appropriate empty/error states.
</objective>

<execution_context>
@/Users/thomas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (processing status infrastructure)
@.planning/phases/11-processing-status-foundation/11-01-SUMMARY.md
@.planning/phases/11-processing-status-foundation/11-02-SUMMARY.md

# Key source files to reference
@staff/app/composables/useQueueActions.ts
@staff/app/components/dashboard/StatusBadge.vue
@staff/app/components/dashboard/NowProcessingSection.vue
@staff/app/pages/index.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create gate page with validation and error states</name>
  <files>staff/app/pages/gate/[id].vue</files>
  <action>
Create the gate operator page at `staff/app/pages/gate/[id].vue`:

1. Add auth middleware using `definePageMeta({ middleware: 'auth' })`

2. Extract gateId from route params: `const gateId = computed(() => route.params.id as string)`

3. Fetch gate info with useAsyncData:
   - Query gates table by id
   - Select: id, gate_number, is_active
   - Use `.single()` for single record

4. Handle error states:
   - Gate not found: Show "Gate Not Found" message with link back to dashboard
   - Gate disabled (is_active = false): Show "Gate is currently disabled" message

5. Fetch gate queue data with useAsyncData:
   - Query pickup_requests table filtered by assigned_gate_id
   - Select: id, sales_order_number, company_name, status, queue_position, processing_started_at, item_count, po_number
   - Filter: status IN ('in_queue', 'processing')
   - Order: queue_position ascending

6. Create computed properties:
   - `currentPickup`: Processing pickup takes precedence, otherwise position 1
   - `loading`: Combined pending state from both async queries

7. Create mobile-first layout:
   - Gate header: Blue background with large "Gate X" text (2xl font)
   - Main content area with padding
   - Use min-h-screen flex flex-col for full height

8. Show loading skeleton while data fetches (simple div with animate-pulse)

9. Import CurrentPickup and EmptyGateState components (to be created in next tasks)

Do NOT add action buttons or realtime subscription yet - those are in later plans.
  </action>
  <verify>
Run `npm run dev` in staff directory, navigate to /gate/{valid-gate-uuid}:
- Gate header shows "Gate X" with gate number
- Page shows loading state briefly
- No console errors
  </verify>
  <done>Gate page renders with gate header and handles invalid/disabled gate states</done>
</task>

<task type="auto">
  <name>Task 2: Create CurrentPickup and EmptyGateState components</name>
  <files>
staff/app/components/gate/CurrentPickup.vue
staff/app/components/gate/EmptyGateState.vue
  </files>
  <action>
**Create CurrentPickup.vue** at `staff/app/components/gate/CurrentPickup.vue`:

1. Define props interface:
```typescript
interface Props {
  salesOrderNumber: string
  companyName: string | null
  status: 'in_queue' | 'processing'
  processingStartedAt: string | null
  itemCount: number | null
  poNumber: string | null
}
```

2. Layout structure using Card component:
   - Card with prominent border (border-2 border-primary)
   - CardHeader with "Now Serving" label (small, muted text)
   - CardContent with:
     - Sales order number: 4xl font, mono, bold, centered, tracking-wider (scannable)
     - Company name: xl font, centered, muted-foreground
     - Order details row (if available): centered, small text, muted
       - Item count: "X items"
       - PO number: "PO: X"
     - StatusBadge centered at bottom (import from dashboard/StatusBadge.vue)

3. Use existing StatusBadge component for status display:
   - Pass status and processing-started-at props

**Create EmptyGateState.vue** at `staff/app/components/gate/EmptyGateState.vue`:

1. No props needed

2. Layout:
   - Centered container with min-h-[50vh]
   - Inbox icon from lucide-vue-next (h-24 w-24, muted color)
   - Heading: "No Pickups Assigned" (xl font, semibold, muted)
   - Subtext: "Pickups will appear here when assigned to this gate."

3. Import Inbox from lucide-vue-next

**Update gate page** to use these components:

1. Import both components
2. Show CurrentPickup when currentPickup exists, passing all props
3. Show EmptyGateState when no currentPickup and not loading
  </action>
  <verify>
1. Navigate to /gate/{uuid} with an assigned pickup:
   - Sales order number displays large and prominent (4xl)
   - Company name shows below
   - StatusBadge shows correct status

2. Navigate to /gate/{uuid} with no assigned pickups:
   - Empty state shows with Inbox icon
   - "No Pickups Assigned" message displays
  </verify>
  <done>CurrentPickup shows large sales order number with company and details; EmptyGateState shows friendly message when idle</done>
</task>

</tasks>

<verification>
All verification commands run from project root:

1. Gate page routing:
   - `cd staff && npm run dev`
   - Navigate to /gate/{valid-gate-uuid}
   - Gate header shows "Gate X"

2. Current pickup display:
   - Add a test pickup to a gate via dashboard
   - Navigate to /gate/{gate-uuid}
   - Sales order number is prominent (4xl mono font)
   - Company name visible
   - StatusBadge shows status

3. Empty state:
   - Navigate to gate with no pickups
   - Inbox icon and "No Pickups Assigned" message display

4. Error states:
   - Navigate to /gate/invalid-uuid
   - "Gate Not Found" message displays
</verification>

<success_criteria>
- Gate operator can view /gate/[id] showing gate header with gate number
- Current pickup displays with large, scannable sales order number (4xl mono font)
- Company name and order details (item count, PO#) visible when available
- StatusBadge shows processing status with elapsed time
- Empty state shows when no pickups assigned
- Error state shows for invalid or disabled gates
- Page uses auth middleware
</success_criteria>

<output>
After completion, create `.planning/phases/12-gate-operator-view/12-01-SUMMARY.md`
</output>
