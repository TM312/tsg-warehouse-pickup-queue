---
phase: 23-component-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - staff/app/components/NavUser.vue
  - staff/app/components/dashboard/ProcessingGatesTable.vue
autonomous: true

must_haves:
  truths:
    - "Sidebar footer shows user name prominently with smaller email below"
    - "Sidebar dropdown menu opens to the right side on desktop"
    - "ProcessingGatesTable idle rows display clean 'Idle' text without dashes"
    - "Idle rows are visually muted/grayed"
  artifacts:
    - path: "staff/app/components/NavUser.vue"
      provides: "Stacked name/email layout with right-side dropdown"
      contains: "displayName"
    - path: "staff/app/components/dashboard/ProcessingGatesTable.vue"
      provides: "Muted idle rows with colspan"
      contains: "colspan"
  key_links:
    - from: "NavUser.vue"
      to: "DropdownMenuContent"
      via: "side prop"
      pattern: 'side="right"'
    - from: "ProcessingGatesTable.vue"
      to: "TableCell"
      via: "colspan attribute"
      pattern: "colspan.*3"
---

<objective>
Polish two sidebar/dashboard components: NavUser stacked layout with right-side dropdown, and ProcessingGatesTable clean idle state display.

Purpose: Refine visual hierarchy in sidebar footer (name > email) and eliminate visual clutter in idle gate rows (no more em-dashes).
Output: Updated NavUser.vue and ProcessingGatesTable.vue with improved UX.
</objective>

<execution_context>
@/Users/thomas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-component-polish/23-CONTEXT.md
@.planning/phases/23-component-polish/23-RESEARCH.md
@staff/app/components/NavUser.vue
@staff/app/components/dashboard/ProcessingGatesTable.vue
@staff/app/components/ui/sidebar/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update NavUser to stacked layout with right-side dropdown</name>
  <files>staff/app/components/NavUser.vue</files>
  <action>
Update NavUser.vue with these changes:

1. Add ChevronsUpDown import (replace ChevronUp):
   ```typescript
   import { ChevronsUpDown, LogOut } from 'lucide-vue-next'
   ```

2. Add displayName computed property that derives name from email:
   ```typescript
   const displayName = computed(() => {
     // Prefer user metadata name if available
     if (user.value?.user_metadata?.name) {
       return user.value.user_metadata.name
     }
     // Fall back to email username portion
     const email = user.value?.email ?? ''
     const username = email.split('@')[0] ?? ''
     // Convert to title case: john.doe -> John Doe
     return username
       .replace(/[._-]/g, ' ')
       .replace(/\b\w/g, c => c.toUpperCase())
   })
   ```

3. Update SidebarMenuButton to use `size="lg"` for taller height (h-12 from variants)

4. Update Avatar to `class="h-8 w-8 rounded-lg"` and AvatarFallback to `class="rounded-lg"` (no text-xs needed with larger avatar)

5. Replace single email span with stacked layout:
   ```vue
   <div class="grid flex-1 text-left text-sm leading-tight">
     <span class="truncate font-semibold">{{ displayName }}</span>
     <span class="truncate text-xs text-muted-foreground">{{ user?.email }}</span>
   </div>
   ```

6. Replace ChevronUp with ChevronsUpDown (same size classes: `class="ml-auto size-4"`)

7. Update DropdownMenuContent:
   - Change `side="top"` to `side="right"`
   - Change width from `w-[--reka-popper-anchor-width]` to `w-56`
   - Add `rounded-lg` class for consistency
   - Add `:side-offset="4"` and `align="end"` props

Keep the existing logout functionality and DropdownMenuItem unchanged.
  </action>
  <verify>
Run `npm run build --prefix staff` - no TypeScript errors.
Visual check: NavUser shows name on top line (bold), email below (smaller, muted), dropdown opens to right.
  </verify>
  <done>
NavUser displays stacked name/email layout with name prominent (semibold) and email smaller (text-xs, muted).
Dropdown opens to the right side with appropriate offset.
ChevronsUpDown icon indicates dropdown behavior.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update ProcessingGatesTable idle state display</name>
  <files>staff/app/components/dashboard/ProcessingGatesTable.vue</files>
  <action>
Update ProcessingGatesTable.vue idle state template:

1. Add opacity class to the TableRow for idle gates:
   ```vue
   <TableRow
     v-for="gate in gates"
     :key="gate.id"
     :class="[
       gate.order ? 'cursor-pointer hover:bg-accent/50' : 'opacity-60',
     ]"
     @click="gate.order && emit('rowClick', gate.order.id)"
   >
   ```

2. Replace the idle state template (v-else section) with colspan approach:
   ```vue
   <template v-else>
     <TableCell colspan="3" class="text-center text-muted-foreground italic">
       Idle
     </TableCell>
     <TableCell></TableCell>
   </template>
   ```

   Note: Table has 5 columns (Gate, Order, Company, Status, Actions).
   - Gate column (TableCell before the template) is always shown
   - colspan="3" spans Order + Company + Status
   - Final TableCell (empty) is for Actions column alignment

This removes the em-dashes and provides a clean, centered "Idle" text spanning across the order/company/status columns while maintaining proper column alignment.
  </action>
  <verify>
Run `npm run build --prefix staff` - no TypeScript errors.
Visual check: Idle gates show dimmed row with single centered "Idle" text, no dashes.
  </verify>
  <done>
ProcessingGatesTable idle rows are visually muted (opacity-60).
"Idle" text is centered and spans across Order/Company/Status columns.
No em-dashes or empty text in idle rows.
Column alignment is preserved (Gate | Idle spanning 3 | Actions).
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Build verification: `npm run build --prefix staff` passes without errors
2. Type check: `npm run typecheck --prefix staff` passes (if script exists)
3. Visual verification:
   - NavUser in sidebar footer shows: Avatar | Name (bold) / Email (small) | Up-down chevron
   - Clicking NavUser opens dropdown to the RIGHT of the button
   - ProcessingGatesTable idle rows are dimmed with centered "Idle" text
   - No em-dashes visible in idle rows
</verification>

<success_criteria>
1. Sidebar footer displays user name prominently (semibold) with smaller email below (text-xs, muted)
2. Sidebar dropdown menu opens to the right side on desktop
3. ProcessingGatesTable idle rows show muted styling (opacity-60)
4. Idle rows display clean "Idle" text centered across 3 columns, no dashes
5. Build completes without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/23-component-polish/23-01-SUMMARY.md`
</output>
