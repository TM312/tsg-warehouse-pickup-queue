---
phase: 03-staff-authentication
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/nuxt.config.ts
  - app/package.json
  - app/tsconfig.json
  - app/app.vue
  - app/middleware/auth.ts
  - app/layouts/default.vue
  - app/layouts/auth.vue
  - app/components.json
  - app/.env.example
autonomous: true

must_haves:
  truths:
    - "Nuxt development server starts successfully"
    - "Supabase module is configured and composables are available"
    - "shadcn-vue components are configured and importable"
    - "Auth middleware exists and can check user state"
  artifacts:
    - path: "app/nuxt.config.ts"
      provides: "Nuxt configuration with Supabase module"
      contains: "@nuxtjs/supabase"
    - path: "app/middleware/auth.ts"
      provides: "Route protection middleware"
      contains: "useSupabaseUser"
    - path: "app/layouts/default.vue"
      provides: "Default layout for authenticated pages"
      min_lines: 10
    - path: "app/layouts/auth.vue"
      provides: "Auth layout for login/public pages"
      min_lines: 5
  key_links:
    - from: "app/nuxt.config.ts"
      to: "@nuxtjs/supabase"
      via: "modules array"
      pattern: "modules.*@nuxtjs/supabase"
    - from: "app/middleware/auth.ts"
      to: "useSupabaseUser"
      via: "composable import"
      pattern: "useSupabaseUser\\(\\)"
---

<objective>
Initialize the Nuxt 3 application with Supabase authentication infrastructure and shadcn-vue UI components.

Purpose: Establish the frontend foundation that all staff dashboard features will build upon. This plan creates the application shell, configures authentication composables, and sets up the UI component library.

Output: A working Nuxt 3 development environment with Supabase module configured, shadcn-vue installed, form validation ready, and auth middleware in place.
</objective>

<execution_context>
@/Users/thomas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-staff-authentication/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Nuxt 3 app with Supabase module</name>
  <files>
    app/nuxt.config.ts
    app/package.json
    app/tsconfig.json
    app/app.vue
    app/.env.example
  </files>
  <action>
Create Nuxt 3 application in `app/` directory:

1. Run `pnpm dlx nuxi@latest init app --packageManager pnpm --gitInit false` to scaffold Nuxt project
2. Change to app directory and install Supabase module: `pnpm add @nuxtjs/supabase`
3. Install form validation dependencies: `pnpm add vee-validate @vee-validate/zod zod`

4. Configure nuxt.config.ts:
```typescript
export default defineNuxtConfig({
  compatibilityDate: '2024-11-01',
  devtools: { enabled: true },
  modules: ['@nuxtjs/supabase'],
  supabase: {
    redirectOptions: {
      login: '/login',
      callback: '/confirm',
      include: undefined,
      exclude: ['/', '/forgot-password', '/password/update'],
      cookieRedirect: false,
    }
  }
})
```

Note: The @nuxtjs/supabase module reads SUPABASE_URL and SUPABASE_KEY from environment variables automatically. Do NOT put them in nuxt.config.ts.

5. Create .env.example documenting required environment variables:
```
# Supabase configuration
# Get these from your Supabase project settings > API
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-anon-key
```

6. Update app.vue to use NuxtPage:
```vue
<template>
  <NuxtLayout>
    <NuxtPage />
  </NuxtLayout>
</template>
```
  </action>
  <verify>
    Run `cd app && pnpm dev` and confirm server starts at http://localhost:3000 without errors
  </verify>
  <done>
    Nuxt dev server starts, @nuxtjs/supabase module loads (even without credentials), and app.vue renders NuxtPage
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure shadcn-vue and create layouts with auth middleware</name>
  <files>
    app/components.json
    app/middleware/auth.ts
    app/layouts/default.vue
    app/layouts/auth.vue
    app/lib/utils.ts
    app/assets/css/tailwind.css
    app/tailwind.config.ts
  </files>
  <action>
1. Initialize shadcn-vue in the app directory:
```bash
cd app && pnpm dlx shadcn-vue@latest init
```
When prompted:
- TypeScript: yes
- Framework: Nuxt
- Style: Default (or New York)
- Base color: Slate (or preference)
- CSS variables: yes
- Tailwind CSS config: tailwind.config.ts
- Import aliases: use defaults

This will:
- Create components.json
- Create lib/utils.ts with cn() helper
- Create tailwind.config.ts
- Create assets/css/tailwind.css
- Update nuxt.config.ts to include Tailwind

2. Add shadcn-vue components needed for auth forms:
```bash
cd app && pnpm dlx shadcn-vue@latest add card button input label
```

3. Create auth middleware at middleware/auth.ts:
```typescript
export default defineNuxtRouteMiddleware((to, from) => {
  const user = useSupabaseUser()

  // Public paths that don't require authentication
  const publicPaths = ['/login', '/forgot-password', '/confirm', '/password/update']

  // Allow access to public pages
  if (publicPaths.some(path => to.path.startsWith(path))) {
    // If logged in and trying to access login, redirect to dashboard
    if (user.value && to.path === '/login') {
      return navigateTo('/')
    }
    return
  }

  // Redirect unauthenticated users to login
  if (!user.value) {
    return navigateTo('/login')
  }
})
```

4. Create default layout at layouts/default.vue:
```vue
<script setup lang="ts">
const supabase = useSupabaseClient()

async function logout() {
  await supabase.auth.signOut()
  await navigateTo('/login')
}
</script>

<template>
  <div class="min-h-screen bg-background">
    <header class="border-b">
      <div class="container mx-auto px-4 py-3 flex items-center justify-between">
        <h1 class="text-lg font-semibold">Warehouse Pickup Queue</h1>
        <Button variant="ghost" size="sm" @click="logout">
          Logout
        </Button>
      </div>
    </header>
    <main class="container mx-auto px-4 py-6">
      <slot />
    </main>
  </div>
</template>
```

5. Create auth layout at layouts/auth.vue (minimal layout for login pages):
```vue
<template>
  <div class="min-h-screen bg-background">
    <slot />
  </div>
</template>
```
  </action>
  <verify>
    1. Run `cd app && pnpm dev`
    2. Check that Tailwind styles are applied (background colors, fonts)
    3. Verify components.json exists and contains shadcn configuration
    4. Confirm middleware/auth.ts exists
  </verify>
  <done>
    shadcn-vue is configured with Card/Button/Input/Label components, Tailwind CSS is working, auth middleware exists with public path exclusions, and both layouts are created with logout available in default layout
  </done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `cd app && pnpm dev` starts without errors
2. `ls app/components/ui/` shows button/, card/, input/, label/ directories
3. `cat app/middleware/auth.ts` shows route protection logic with public path exclusions
4. `cat app/nuxt.config.ts` includes @nuxtjs/supabase in modules
5. Both layouts exist: app/layouts/default.vue and app/layouts/auth.vue
</verification>

<success_criteria>
- Nuxt 3 application runs at http://localhost:3000
- Supabase module is configured (will show warnings without credentials, but loads)
- shadcn-vue components are installed and importable
- Auth middleware exists with proper public path handling
- Default layout includes logout button
- Auth layout exists for login pages
- Form validation packages (vee-validate, zod) are installed
</success_criteria>

<output>
After completion, create `.planning/phases/03-staff-authentication/03-01-SUMMARY.md`
</output>
