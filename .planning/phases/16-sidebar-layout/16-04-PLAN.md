---
phase: 16-sidebar-layout
plan: 04
type: execute
wave: 3
depends_on: ["16-01", "16-03"]
files_modified:
  - staff/app/layouts/default.vue
autonomous: false

must_haves:
  truths:
    - "Dashboard page is accessible via sidebar navigation"
    - "Gates link is visible in sidebar navigation"
    - "Schedule page is accessible via sidebar navigation"
    - "Sidebar collapses to icons on desktop via toggle button"
    - "Sidebar shows as overlay on mobile screens"
    - "Current page is visually highlighted in sidebar"
    - "Sidebar toggle button is in the main content header"
  artifacts:
    - path: "staff/app/layouts/default.vue"
      provides: "Default layout with sidebar navigation"
      min_lines: 30
      contains: "SidebarProvider"
  key_links:
    - from: "staff/app/layouts/default.vue"
      to: "staff/app/components/AppSidebar.vue"
      via: "import and render in template"
      pattern: "AppSidebar"
    - from: "staff/app/layouts/default.vue"
      to: "staff/app/components/ui/sidebar"
      via: "SidebarProvider, SidebarInset, SidebarTrigger"
      pattern: "SidebarProvider"
---

<objective>
Update the default layout to use the sidebar navigation structure with SidebarProvider, AppSidebar, and SidebarInset.

Purpose: Replace the existing header-based navigation with the shadcn-vue sidebar layout. This provides collapsible navigation, mobile responsiveness, and consistent navigation throughout the staff application.

Output: Updated default.vue layout that wraps content with SidebarProvider and renders AppSidebar with SidebarInset for main content.
</objective>

<execution_context>
@/Users/thomas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-sidebar-layout/16-CONTEXT.md
@.planning/phases/16-sidebar-layout/16-RESEARCH.md
@.planning/phases/16-sidebar-layout/16-01-SUMMARY.md
@.planning/phases/16-sidebar-layout/16-03-SUMMARY.md
@staff/app/layouts/default.vue
@staff/app/components/AppSidebar.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update default layout with sidebar structure</name>
  <files>staff/app/layouts/default.vue</files>
  <action>
Replace the existing default.vue layout with the sidebar-based structure.

Current layout has:
- Header with title, Settings link, and Logout button
- Main content area with container

New layout should have:
- SidebarProvider wrapper
- AppSidebar component
- SidebarInset for main content
- Header inside SidebarInset with SidebarTrigger and Separator
- Main content area with container and slot

Key requirements from CONTEXT.md:
- Toggle button in main content header (not in sidebar) - use SidebarTrigger
- Use SidebarInset to avoid height overflow issues
- Remove old header navigation (moved to sidebar)

Replace staff/app/layouts/default.vue with:
```vue
<script setup lang="ts">
import AppSidebar from '@/components/AppSidebar.vue'
import {
  SidebarProvider,
  SidebarInset,
  SidebarTrigger,
} from '@/components/ui/sidebar'
import { Separator } from '@/components/ui/separator'
</script>

<template>
  <SidebarProvider>
    <AppSidebar />
    <SidebarInset>
      <header class="flex h-14 shrink-0 items-center gap-2 border-b px-4">
        <SidebarTrigger class="-ml-1" />
        <Separator orientation="vertical" class="mr-2 h-4" />
        <span class="font-semibold">Warehouse Pickup Queue</span>
      </header>
      <main class="flex-1 overflow-auto">
        <div class="container mx-auto px-4 py-6">
          <slot />
        </div>
      </main>
    </SidebarInset>
  </SidebarProvider>
</template>
```

Changes from old layout:
1. REMOVED: Old header with Settings link and Logout button (now in sidebar)
2. REMOVED: Logout function (moved to NavUser component)
3. ADDED: SidebarProvider wrapper
4. ADDED: AppSidebar component
5. ADDED: SidebarInset for proper layout
6. ADDED: SidebarTrigger in header for collapse toggle
7. ADDED: Separator between trigger and title
8. KEPT: Container mx-auto px-4 py-6 for main content
  </action>
  <verify>
Verify the layout has correct structure:
```bash
cat staff/app/layouts/default.vue
```
Should show:
- SidebarProvider wrapper
- AppSidebar import and usage
- SidebarInset wrapping content
- SidebarTrigger in header
- Separator component

Verify TypeScript passes:
```bash
cd staff && npx nuxi typecheck 2>&1 | head -50
```

Verify no references to old logout function:
```bash
grep -c "logout" staff/app/layouts/default.vue || echo "No logout found (expected)"
```
Should return 0 or "No logout found"
  </verify>
  <done>default.vue layout uses SidebarProvider, AppSidebar, SidebarInset, and SidebarTrigger in header</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete sidebar layout for staff application:
- Sidebar with Dashboard, Gates, and Schedule navigation
- User section in footer with logout dropdown
- Collapsible sidebar (desktop: icon rail, mobile: drawer overlay)
- Toggle button in header
- Gate operator routes remain fullscreen without sidebar
  </what-built>
  <how-to-verify>
1. Start the staff app: `cd staff && npm run dev`
2. Navigate to http://localhost:3000 (login if needed - staff@example.com / password123)

**Sidebar Navigation:**
- [ ] Sidebar appears on left side with three nav items: Dashboard, Gates, Schedule
- [ ] Dashboard (home icon) links to /
- [ ] Gates (door icon) links to /gates (may show 404 - that's expected)
- [ ] Schedule (calendar icon) links to /settings/business-hours
- [ ] Current page is highlighted in sidebar

**Collapse Behavior:**
- [ ] Click the hamburger/toggle button in the header
- [ ] Sidebar collapses to show only icons
- [ ] Click toggle again - sidebar expands back
- [ ] Icons have tooltips when collapsed

**User Section:**
- [ ] Footer shows user avatar (2 letter initials) and email
- [ ] Click user section to open dropdown
- [ ] Dropdown has "Log out" option
- [ ] Click "Log out" - redirects to login page

**Mobile (resize browser to < 768px or use DevTools):**
- [ ] Sidebar becomes a drawer that slides from left
- [ ] Toggle button shows/hides the drawer
- [ ] Click a nav item - drawer closes automatically
- [ ] Tap outside drawer - it closes

**Gate Operator (fullscreen):**
- [ ] Navigate to any gate: /gate/{gate-id} (get ID from dashboard gate selector)
- [ ] Page shows fullscreen without sidebar
- [ ] All gate functionality works (if there are pickups in queue)
- [ ] "Back to Dashboard" link works
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Layout structure is correct:
```bash
cat staff/app/layouts/default.vue
```

2. TypeScript passes:
```bash
cd staff && npx nuxi typecheck
```

3. App builds without errors:
```bash
cd staff && npm run build
```

4. Manual verification of all sidebar functionality (checkpoint)
</verification>

<success_criteria>
1. staff/app/layouts/default.vue uses SidebarProvider, AppSidebar, SidebarInset
2. Header contains SidebarTrigger for collapse toggle
3. Old logout function removed from layout (moved to NavUser)
4. TypeScript compilation passes
5. App builds successfully
6. Human verification confirms:
   - Sidebar navigation works (Dashboard, Gates, Schedule)
   - Current page highlighting works
   - Collapse/expand works on desktop
   - Mobile drawer works
   - User logout works
   - Gate pages remain fullscreen
</success_criteria>

<output>
After completion, create `.planning/phases/16-sidebar-layout/16-04-SUMMARY.md`
</output>
