---
phase: 16-sidebar-layout
plan: 03
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - staff/app/components/AppSidebar.vue
  - staff/app/components/NavUser.vue
autonomous: true

must_haves:
  truths:
    - "AppSidebar renders three navigation items: Dashboard, Gates, Schedule"
    - "Current route is visually highlighted in sidebar navigation"
    - "NavUser shows user email with avatar and logout dropdown"
    - "Logout functionality works from sidebar"
  artifacts:
    - path: "staff/app/components/AppSidebar.vue"
      provides: "Main sidebar component with navigation"
      min_lines: 50
      contains: "variant=\"inset\""
    - path: "staff/app/components/NavUser.vue"
      provides: "User section with dropdown menu"
      min_lines: 30
      contains: "logout"
  key_links:
    - from: "staff/app/components/AppSidebar.vue"
      to: "staff/app/components/ui/sidebar"
      via: "import Sidebar components"
      pattern: "from ['\"]@/components/ui/sidebar['\"]"
    - from: "staff/app/components/NavUser.vue"
      to: "staff/app/components/ui/dropdown-menu"
      via: "import DropdownMenu components"
      pattern: "from ['\"]@/components/ui/dropdown-menu['\"]"
---

<objective>
Create the AppSidebar and NavUser components for the staff application sidebar.

Purpose: AppSidebar is the main sidebar component containing navigation items (Dashboard, Gates, Schedule) with active route highlighting. NavUser provides the user section in the sidebar footer with avatar, email display, and logout dropdown.

Output: Two new components in staff/app/components/ that will be used by the default layout.
</objective>

<execution_context>
@/Users/thomas/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thomas/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-sidebar-layout/16-CONTEXT.md
@.planning/phases/16-sidebar-layout/16-RESEARCH.md
@.planning/phases/16-sidebar-layout/16-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AppSidebar component</name>
  <files>staff/app/components/AppSidebar.vue</files>
  <action>
Create staff/app/components/AppSidebar.vue with the sidebar structure following the dashboard-01 pattern.

Key requirements from CONTEXT.md:
- Use `variant="inset"` and `collapsible="icon"` on Sidebar
- Three nav items: Dashboard (/), Gates (/gates), Schedule (/settings/business-hours)
- Use House, DoorOpen, Calendar icons from lucide-vue-next
- Active route highlighting via `route.path === item.url` comparison
- Auto-close sidebar on mobile after navigation
- Include SidebarRail for the collapse rail
- Header with app branding text "Warehouse Pickup Queue"
- Footer with NavUser component

Structure:
```vue
<script setup lang="ts">
import { House, DoorOpen, Calendar } from 'lucide-vue-next'
import {
  Sidebar,
  SidebarHeader,
  SidebarContent,
  SidebarGroup,
  SidebarGroupContent,
  SidebarMenu,
  SidebarMenuItem,
  SidebarMenuButton,
  SidebarFooter,
  SidebarRail,
  useSidebar,
} from '@/components/ui/sidebar'
import NavUser from '@/components/NavUser.vue'

const items = [
  { title: 'Dashboard', url: '/', icon: House },
  { title: 'Gates', url: '/gates', icon: DoorOpen },
  { title: 'Schedule', url: '/settings/business-hours', icon: Calendar },
]

const route = useRoute()
const { setOpenMobile, isMobile } = useSidebar()

function handleNavigation() {
  if (isMobile.value) {
    setOpenMobile(false)
  }
}
</script>

<template>
  <Sidebar variant="inset" collapsible="icon">
    <SidebarHeader>
      <div class="flex items-center gap-2 px-2 py-2">
        <span class="font-semibold text-sm truncate">Warehouse Pickup Queue</span>
      </div>
    </SidebarHeader>
    <SidebarContent>
      <SidebarGroup>
        <SidebarGroupContent>
          <SidebarMenu>
            <SidebarMenuItem v-for="item in items" :key="item.title">
              <SidebarMenuButton
                as-child
                :is-active="route.path === item.url"
                @click="handleNavigation"
              >
                <NuxtLink :to="item.url">
                  <component :is="item.icon" />
                  <span>{{ item.title }}</span>
                </NuxtLink>
              </SidebarMenuButton>
            </SidebarMenuItem>
          </SidebarMenu>
        </SidebarGroupContent>
      </SidebarGroup>
    </SidebarContent>
    <SidebarFooter>
      <NavUser />
    </SidebarFooter>
    <SidebarRail />
  </Sidebar>
</template>
```

Note: The Gates link goes to /gates which may not exist yet. That's expected - we're building the navigation structure first. The route can be created in a future phase or as part of dashboard refactoring.
  </action>
  <verify>
Verify the component exists with correct structure:
```bash
cat staff/app/components/AppSidebar.vue
```
Should show:
- variant="inset" on Sidebar
- Three navigation items with correct URLs
- isActive check using route.path comparison
- handleNavigation function for mobile auto-close
- NavUser in SidebarFooter

Verify imports resolve:
```bash
cd staff && npx nuxi typecheck 2>&1 | head -50
```
  </verify>
  <done>AppSidebar.vue exists with three navigation items (Dashboard, Gates, Schedule), active route highlighting, mobile auto-close, and NavUser in footer</done>
</task>

<task type="auto">
  <name>Task 2: Create NavUser component</name>
  <files>staff/app/components/NavUser.vue</files>
  <action>
Create staff/app/components/NavUser.vue with user section and logout dropdown.

Key requirements from CONTEXT.md:
- Avatar with user initials (first 2 chars of email)
- Display user email (truncated)
- Dropdown menu with logout option
- Use ChevronUp icon for dropdown indicator
- Logout calls supabase.auth.signOut() and navigates to /login

Structure:
```vue
<script setup lang="ts">
import { ChevronUp, LogOut } from 'lucide-vue-next'
import { Avatar, AvatarFallback } from '@/components/ui/avatar'
import {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
} from '@/components/ui/dropdown-menu'
import {
  SidebarMenu,
  SidebarMenuItem,
  SidebarMenuButton,
} from '@/components/ui/sidebar'

const supabase = useSupabaseClient()
const user = useSupabaseUser()

async function logout() {
  await supabase.auth.signOut()
  await navigateTo('/login')
}

const initials = computed(() => {
  const email = user.value?.email ?? ''
  return email.substring(0, 2).toUpperCase()
})
</script>

<template>
  <SidebarMenu>
    <SidebarMenuItem>
      <DropdownMenu>
        <DropdownMenuTrigger as-child>
          <SidebarMenuButton>
            <Avatar class="h-6 w-6">
              <AvatarFallback class="text-xs">{{ initials }}</AvatarFallback>
            </Avatar>
            <span class="truncate">{{ user?.email }}</span>
            <ChevronUp class="ml-auto h-4 w-4" />
          </SidebarMenuButton>
        </DropdownMenuTrigger>
        <DropdownMenuContent
          side="top"
          class="w-[--reka-popper-anchor-width]"
        >
          <DropdownMenuItem @click="logout">
            <LogOut class="mr-2 h-4 w-4" />
            <span>Log out</span>
          </DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    </SidebarMenuItem>
  </SidebarMenu>
</template>
```

The component:
- Uses useSupabaseClient() and useSupabaseUser() for auth (Nuxt auto-imports)
- Computes initials from email (first 2 characters, uppercase)
- Provides logout via dropdown menu
- Dropdown opens upward (side="top") as it's in the footer
  </action>
  <verify>
Verify the component exists with correct structure:
```bash
cat staff/app/components/NavUser.vue
```
Should show:
- Avatar with computed initials
- User email display
- DropdownMenu with logout option
- logout function calling supabase.auth.signOut()

Verify imports resolve:
```bash
cd staff && npx nuxi typecheck 2>&1 | head -50
```
  </verify>
  <done>NavUser.vue exists with avatar showing initials, email display, and dropdown menu with logout functionality</done>
</task>

</tasks>

<verification>
1. Both components exist:
```bash
ls -la staff/app/components/AppSidebar.vue staff/app/components/NavUser.vue
```

2. AppSidebar has correct navigation items:
```bash
grep -E "(Dashboard|Gates|Schedule)" staff/app/components/AppSidebar.vue
```

3. NavUser has logout:
```bash
grep "logout" staff/app/components/NavUser.vue
```

4. TypeScript passes:
```bash
cd staff && npx nuxi typecheck
```
</verification>

<success_criteria>
1. staff/app/components/AppSidebar.vue exists with:
   - Sidebar variant="inset" collapsible="icon"
   - Three nav items: Dashboard (/), Gates (/gates), Schedule (/settings/business-hours)
   - Active route highlighting via route.path comparison
   - Mobile auto-close via handleNavigation
   - NavUser in SidebarFooter
   - SidebarRail for collapse rail
2. staff/app/components/NavUser.vue exists with:
   - Avatar showing computed initials
   - User email display
   - Dropdown menu with logout option
   - Logout calls signOut and navigates to /login
3. TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/16-sidebar-layout/16-03-SUMMARY.md`
</output>
